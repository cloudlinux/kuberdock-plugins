#!/usr/local/bin/php

<?php
    require_once __DIR__ . '/../KuberDock/init.php';

    $controller = isset($_GET[\Kuberdock\classes\KuberDock_Controller::CONTROLLER_PARAM])
        ? $_GET[\Kuberdock\classes\KuberDock_Controller::CONTROLLER_PARAM]
        : 'default';

    $action = isset($_GET[\Kuberdock\classes\KuberDock_Controller::CONTROLLER_ACTION_PARAM])
        ? $_GET[\Kuberdock\classes\KuberDock_Controller::CONTROLLER_ACTION_PARAM]
        : 'index';

    try {
        $className = '\Kuberdock\classes\controllers\\' . ucfirst($controller) . 'Controller';
        $model = new $className;
        $model->controller = strtolower($controller);
        $model->action = $action;
        $model->setView();
        $actionMethod = lcfirst($action) . 'Action';

        if (!method_exists($model, $actionMethod)) {
            throw new \Kuberdock\classes\exceptions\CException('Undefined controller action "'.$action.'"');
        }

        $method = new \ReflectionMethod($model, $actionMethod);
        $method->invoke($model);
    } catch(\Kuberdock\classes\exceptions\CException $e) {
        echo $e;
    }
?>